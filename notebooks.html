

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Analisis Explotarorio de datos (EDA) &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Notebooks with MyST Markdown" href="markdown-notebooks.html" />
    <link rel="prev" title="Markdown Files" href="markdown.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="markdown.html">Markdown Files</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Analisis Explotarorio de datos (EDA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="markdown-notebooks.html">Notebooks with MyST Markdown</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/notebooks.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Analisis Explotarorio de datos (EDA)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-wind-speed">Datos Wind Speed</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descripcion-del-tipo-de-variables">Descripcion del tipo de variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduccion-de-nombres-extensos-en-columnas">Reducción de nombres extensos en columnas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#numero-de-observaciones-media-desviacion-estandar-minimo-maximo-cuartiles">Número de observaciones, media, desviación estándar, mínimo, máximo, cuartiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conteo-de-datos-faltantes-y-su-porcentaje">Conteo de datos faltantes y su porcentaje</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#histograma-o-diagrama-de-barras-para-la-variables">Histograma o diagrama de barras para la variables</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-fraud-detection">Datos Fraud Detection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Descripcion del tipo de variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calcular-numero-de-observaciones-media-desviacion-estandar-minimo-maximo-cuartiles">Calcular número de observaciones, media, desviación estándar, mínimo, máximo, cuartiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#histograma-de-variables-numericas">Histograma de variables numericas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ejercicio-5-modelo-de-clasificacion">Ejercicio 5. Modelo de clasificación</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ejercicio-5-modelos-de-regresion">Ejercicio 5. Modelos de regresion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kneighborsregressor">KNeighborsRegressor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso">Lasso</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge">Ridge</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost">XGboost</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#svr">SVR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mlp-regressor">MLP Regressor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluacion-de-los-modelos-con-los-mejores-parametros">Evaluacion de los modelos con los mejores parametros</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusión</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="analisis-explotarorio-de-datos-eda">
<h1>Analisis Explotarorio de datos (EDA)<a class="headerlink" href="#analisis-explotarorio-de-datos-eda" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<section id="datos-wind-speed">
<h2>Datos Wind Speed<a class="headerlink" href="#datos-wind-speed" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">load_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\danie\OneDrive\Documentos\data_treino_dv_df_2000_2010.csv&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">load_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">load_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\danie\OneDrive\Documentos\data_treino_dv_df_2000_2010.csv&quot;</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">load_path</span><span class="p">)</span>

<span class="nn">File ~\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\readers.py:948,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">    </span><span class="mi">935</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">936</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">937</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">944</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">945</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">946</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">948</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File ~\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\readers.py:611,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">608</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">610</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">611</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">613</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">614</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File ~\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\readers.py:1448,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1445</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1447</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1448</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File ~\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\readers.py:1705,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1703</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1704</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1705</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1706</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1707</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1708</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1709</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1710</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1711</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1712</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1713</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1714</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1715</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1716</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File ~\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\common.py:863,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">863</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">864</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">865</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">866</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">867</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">869</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">870</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">871</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">872</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;C:\\Users\\danie\\OneDrive\\Documentos\\data_treino_dv_df_2000_2010.csv&#39;
</pre></div>
</div>
</div>
</div>
<section id="descripcion-del-tipo-de-variables">
<h3>Descripcion del tipo de variables<a class="headerlink" href="#descripcion-del-tipo-de-variables" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 87693 entries, 0 to 87692
Data columns (total 13 columns):
 #   Column                                                 Non-Null Count  Dtype  
---  ------                                                 --------------  -----  
 0   HORA (UTC)                                             87693 non-null  object 
 1   VENTO, DIREï¿½ï¿½O HORARIA (gr) (ï¿½ (gr))             87693 non-null  float64
 2   VENTO, VELOCIDADE HORARIA (m/s)                        87693 non-null  float64
 3   UMIDADE REL. MAX. NA HORA ANT. (AUT) (%)               87693 non-null  float64
 4   UMIDADE REL. MIN. NA HORA ANT. (AUT) (%)               87693 non-null  float64
 5   TEMPERATURA Mï¿½XIMA NA HORA ANT. (AUT) (ï¿½C)         87693 non-null  float64
 6   TEMPERATURA Mï¿½NIMA NA HORA ANT. (AUT) (ï¿½C)         87693 non-null  float64
 7   UMIDADE RELATIVA DO AR, HORARIA (%)                    87693 non-null  float64
 8   PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB)  87693 non-null  float64
 9   PRECIPITAï¿½ï¿½O TOTAL, HORï¿½RIO (mm)                 87693 non-null  float64
 10  VENTO, RAJADA MAXIMA (m/s)                             87693 non-null  float64
 11  PRESSï¿½O ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB)      87693 non-null  float64
 12  PRESSï¿½O ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB)     87693 non-null  float64
dtypes: float64(12), object(1)
memory usage: 8.7+ MB
</pre></div>
</div>
</div>
</div>
<p>El dataframe contiene en total 13 variables, de las cuales 12 son tipo flotante y una es objeto (hora).</p>
</section>
<section id="reduccion-de-nombres-extensos-en-columnas">
<h3>Reducción de nombres extensos en columnas<a class="headerlink" href="#reduccion-de-nombres-extensos-en-columnas" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;HORA (UTC)&#39;, &#39;VENTO, DIREï¿½ï¿½O HORARIA (gr) (ï¿½ (gr))&#39;,
       &#39;VENTO, VELOCIDADE HORARIA (m/s)&#39;,
       &#39;UMIDADE REL. MAX. NA HORA ANT. (AUT) (%)&#39;,
       &#39;UMIDADE REL. MIN. NA HORA ANT. (AUT) (%)&#39;,
       &#39;TEMPERATURA Mï¿½XIMA NA HORA ANT. (AUT) (ï¿½C)&#39;,
       &#39;TEMPERATURA Mï¿½NIMA NA HORA ANT. (AUT) (ï¿½C)&#39;,
       &#39;UMIDADE RELATIVA DO AR, HORARIA (%)&#39;,
       &#39;PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB)&#39;,
       &#39;PRECIPITAï¿½ï¿½O TOTAL, HORï¿½RIO (mm)&#39;, &#39;VENTO, RAJADA MAXIMA (m/s)&#39;,
       &#39;PRESSï¿½O ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB)&#39;,
       &#39;PRESSï¿½O ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB)&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_rename</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;HORA (UTC)&#39;</span><span class="p">:</span> <span class="s2">&quot;hora&quot;</span><span class="p">,</span> 
        <span class="s1">&#39;VENTO, DIREï¿½ï¿½O HORARIA (gr) (ï¿½ (gr))&#39;</span><span class="p">:</span> <span class="s2">&quot;direccion horaria viento&quot;</span><span class="p">,</span>
        <span class="s1">&#39;VENTO, VELOCIDADE HORARIA (m/s)&#39;</span> <span class="p">:</span> <span class="s2">&quot;velocidad horaria viento&quot;</span><span class="p">,</span>
        <span class="s1">&#39;UMIDADE REL. MAX. NA HORA ANT. (AUT) (%)&#39;</span> <span class="p">:</span> <span class="s2">&quot;humedad rel. max hora anterior&quot;</span><span class="p">,</span>
        <span class="s1">&#39;UMIDADE REL. MIN. NA HORA ANT. (AUT) (%)&#39;</span> <span class="p">:</span><span class="s2">&quot;humedad rel. min hora anterior&quot;</span><span class="p">,</span>
        <span class="s1">&#39;TEMPERATURA Mï¿½XIMA NA HORA ANT. (AUT) (ï¿½C)&#39;</span> <span class="p">:</span> <span class="s2">&quot;temperatura max hora anterior&quot;</span><span class="p">,</span>
        <span class="s1">&#39;TEMPERATURA Mï¿½NIMA NA HORA ANT. (AUT) (ï¿½C)&#39;</span> <span class="p">:</span> <span class="s2">&quot;temperatura min hora anterior&quot;</span><span class="p">,</span>
        <span class="s1">&#39;UMIDADE RELATIVA DO AR, HORARIA (%)&#39;</span> <span class="p">:</span> <span class="s2">&quot;humedad relativa horaria&quot;</span><span class="p">,</span> 
        <span class="s1">&#39;PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB)&#39;</span> <span class="p">:</span><span class="s2">&quot;presion atmosférica a nivel de estacion&quot;</span><span class="p">,</span>
        <span class="s1">&#39;PRECIPITAï¿½ï¿½O TOTAL, HORï¿½RIO (mm)&#39;</span> <span class="p">:</span> <span class="s2">&quot;precipitacion total por hora &quot;</span><span class="p">,</span> 
        <span class="s1">&#39;VENTO, RAJADA MAXIMA (m/s)&#39;</span> <span class="p">:</span> <span class="s2">&quot;maxima rafaga de viento &quot;</span><span class="p">,</span>
        <span class="s1">&#39;PRESSï¿½O ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB)&#39;</span> <span class="p">:</span> <span class="s2">&quot;presion atmosferica max&quot;</span><span class="p">,</span>
        <span class="s1">&#39;PRESSï¿½O ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB)&#39;</span> <span class="p">:</span> <span class="s2">&quot;presion atmosferica min&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">list_rename</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 87693 entries, 0 to 87692
Data columns (total 13 columns):
 #   Column                                   Non-Null Count  Dtype  
---  ------                                   --------------  -----  
 0   hora                                     87693 non-null  object 
 1   direccion horaria viento                 87693 non-null  float64
 2   velocidad horaria viento                 87693 non-null  float64
 3   humedad rel. max hora anterior           87693 non-null  float64
 4   humedad rel. min hora anterior           87693 non-null  float64
 5   temperatura max hora anterior            87693 non-null  float64
 6   temperatura min hora anterior            87693 non-null  float64
 7   humedad relativa horaria                 87693 non-null  float64
 8   presion atmosférica a nivel de estacion  87693 non-null  float64
 9   precipitacion total por hora             87693 non-null  float64
 10  maxima rafaga de viento                  87693 non-null  float64
 11  presion atmosferica max                  87693 non-null  float64
 12  presion atmosferica min                  87693 non-null  float64
dtypes: float64(12), object(1)
memory usage: 8.7+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Pasar horas de objeto a int</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;hora&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;hora&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 87693 entries, 0 to 87692
Data columns (total 13 columns):
 #   Column                                   Non-Null Count  Dtype  
---  ------                                   --------------  -----  
 0   hora                                     87693 non-null  int64  
 1   direccion horaria viento                 87693 non-null  float64
 2   velocidad horaria viento                 87693 non-null  float64
 3   humedad rel. max hora anterior           87693 non-null  float64
 4   humedad rel. min hora anterior           87693 non-null  float64
 5   temperatura max hora anterior            87693 non-null  float64
 6   temperatura min hora anterior            87693 non-null  float64
 7   humedad relativa horaria                 87693 non-null  float64
 8   presion atmosférica a nivel de estacion  87693 non-null  float64
 9   precipitacion total por hora             87693 non-null  float64
 10  maxima rafaga de viento                  87693 non-null  float64
 11  presion atmosferica max                  87693 non-null  float64
 12  presion atmosferica min                  87693 non-null  float64
dtypes: float64(12), int64(1)
memory usage: 8.7 MB
</pre></div>
</div>
</div>
</div>
</section>
<section id="numero-de-observaciones-media-desviacion-estandar-minimo-maximo-cuartiles">
<h3>Número de observaciones, media, desviación estándar, mínimo, máximo, cuartiles<a class="headerlink" href="#numero-de-observaciones-media-desviacion-estandar-minimo-maximo-cuartiles" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>hora</th>
      <td>87693.0</td>
      <td>11.5</td>
      <td>6.9</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>12.0</td>
      <td>18.0</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>direccion horaria viento</th>
      <td>87693.0</td>
      <td>0.4</td>
      <td>0.7</td>
      <td>-1.0</td>
      <td>-0.2</td>
      <td>0.8</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>velocidad horaria viento</th>
      <td>87693.0</td>
      <td>2.5</td>
      <td>1.3</td>
      <td>0.0</td>
      <td>1.5</td>
      <td>2.4</td>
      <td>3.4</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>humedad rel. max hora anterior</th>
      <td>87693.0</td>
      <td>69.1</td>
      <td>19.6</td>
      <td>12.0</td>
      <td>54.0</td>
      <td>72.0</td>
      <td>87.0</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>humedad rel. min hora anterior</th>
      <td>87693.0</td>
      <td>63.2</td>
      <td>20.2</td>
      <td>10.0</td>
      <td>48.0</td>
      <td>64.0</td>
      <td>80.0</td>
      <td>98.0</td>
    </tr>
    <tr>
      <th>temperatura max hora anterior</th>
      <td>87693.0</td>
      <td>21.9</td>
      <td>3.7</td>
      <td>9.2</td>
      <td>19.2</td>
      <td>21.4</td>
      <td>24.7</td>
      <td>35.3</td>
    </tr>
    <tr>
      <th>temperatura min hora anterior</th>
      <td>87693.0</td>
      <td>20.7</td>
      <td>3.5</td>
      <td>8.4</td>
      <td>18.4</td>
      <td>20.2</td>
      <td>23.1</td>
      <td>34.4</td>
    </tr>
    <tr>
      <th>humedad relativa horaria</th>
      <td>87693.0</td>
      <td>66.1</td>
      <td>20.0</td>
      <td>10.0</td>
      <td>51.0</td>
      <td>68.0</td>
      <td>84.0</td>
      <td>99.0</td>
    </tr>
    <tr>
      <th>presion atmosférica a nivel de estacion</th>
      <td>87693.0</td>
      <td>887.3</td>
      <td>4.0</td>
      <td>863.4</td>
      <td>885.3</td>
      <td>887.2</td>
      <td>889.1</td>
      <td>1023.5</td>
    </tr>
    <tr>
      <th>precipitacion total por hora</th>
      <td>87693.0</td>
      <td>0.2</td>
      <td>1.3</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>70.8</td>
    </tr>
    <tr>
      <th>maxima rafaga de viento</th>
      <td>87693.0</td>
      <td>5.2</td>
      <td>2.3</td>
      <td>0.0</td>
      <td>3.4</td>
      <td>5.0</td>
      <td>6.8</td>
      <td>24.3</td>
    </tr>
    <tr>
      <th>presion atmosferica max</th>
      <td>87693.0</td>
      <td>887.6</td>
      <td>3.6</td>
      <td>865.3</td>
      <td>885.6</td>
      <td>887.5</td>
      <td>889.3</td>
      <td>913.1</td>
    </tr>
    <tr>
      <th>presion atmosferica min</th>
      <td>87693.0</td>
      <td>886.9</td>
      <td>3.6</td>
      <td>862.8</td>
      <td>885.0</td>
      <td>886.9</td>
      <td>888.8</td>
      <td>910.9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Dirección Horaria Viento: Los valores varían entre -1 y 1..</p></li>
<li><p>Velocidad Horaria Viento: La velocidad del viento varía entre 0 y 10 m/s, con una media de 2.5 m/s.</p></li>
<li><p>Humedad Relativa: La humedad relativa varía ampliamente, con medias de 69.1% y 63.2% para el máximo y mínimo respectivamente.</p></li>
<li><p>Temperatura: Las temperaturas máxima y mínima tienen medias de 21.9°C y 20.7°C respectivamente, mostrando una variabilidad moderada en el clima del lugar de estudio.</p></li>
<li><p>Humedad Relativa Horaria: La media es del 66.1%, lo que indica un ambiente generalmente húmedo.</p></li>
<li><p>Presión Atmosférica a Nivel de Estación: La presión promedio es de 887.3 mB, con valores que varían desde 863.4 mB hasta 1023.5 mB.</p></li>
<li><p>Precipitación Total por Hora: Aunque la media de precipitación es solo de 0.2 mm, el máximo es de 70.8 mm, esto puede indicar que ocasionalmente ocurran lluvias intensas.</p></li>
<li><p>Máxima Ráfaga de Viento: El viento puede alcanzar rafagas de hasta 24.3 m/s, sin embargo en promedio son de 5.2 m/s.</p></li>
</ul>
</section>
<section id="conteo-de-datos-faltantes-y-su-porcentaje">
<h3>Conteo de datos faltantes y su porcentaje<a class="headerlink" href="#conteo-de-datos-faltantes-y-su-porcentaje" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>hora                                       0
direccion horaria viento                   0
velocidad horaria viento                   0
humedad rel. max hora anterior             0
humedad rel. min hora anterior             0
temperatura max hora anterior              0
temperatura min hora anterior              0
humedad relativa horaria                   0
presion atmosférica a nivel de estacion    0
precipitacion total por hora               0
maxima rafaga de viento                    0
presion atmosferica max                    0
presion atmosferica min                    0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>hora                                       0.0
direccion horaria viento                   0.0
velocidad horaria viento                   0.0
humedad rel. max hora anterior             0.0
humedad rel. min hora anterior             0.0
temperatura max hora anterior              0.0
temperatura min hora anterior              0.0
humedad relativa horaria                   0.0
presion atmosférica a nivel de estacion    0.0
precipitacion total por hora               0.0
maxima rafaga de viento                    0.0
presion atmosferica max                    0.0
presion atmosferica min                    0.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>No hay valores faltantes en el dataset por lo que no es necesario realizar imputación.</p>
</section>
<section id="histograma-o-diagrama-de-barras-para-la-variables">
<h3>Histograma o diagrama de barras para la variables<a class="headerlink" href="#histograma-o-diagrama-de-barras-para-la-variables" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/42435473c823cf94caeb37cca934b0ac9f48c7f1c735c6700e2976c0d86dffec.png" src="_images/42435473c823cf94caeb37cca934b0ac9f48c7f1c735c6700e2976c0d86dffec.png" />
</div>
</div>
<ul class="simple">
<li><p>Velocidad Horaria Viento: esta sezgada a la derecha, se observa adicionalmente que la mayoria de observaciones se encuentran en velocidad más bajas.</p></li>
<li><p>Dirección Horaria Viento: muestra un sesgo hacia la izquierda. Esto sugiere que, aunque hay una dirección predominante del viento que es más frecuente (representada por el pico en el extremo derecho), también hay ocasiones en las que el viento proviene de direcciones opuestas o contrarias.</p></li>
<li><p>Las humedades real max y min se encuentran sezgadas hacia la izquierda.</p></li>
<li><p>La temperatura max y min es simetrica puesto que contiene la mayor cantidad de datos en el centro del grafico, esto traduce a que en general la temperatura oscila en 20 grados centigrados.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>

<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;velocidad horaria viento&#39;</span><span class="p">,</span> <span class="s1">&#39;direccion horaria viento&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;temperatura max hora anterior&#39;</span><span class="p">,</span> <span class="s1">&#39;humedad relativa horaria&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;presion atmosférica a nivel de estacion&#39;</span><span class="p">]</span>

<span class="n">n_cols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_cols</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_cols</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">n_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">n_rows</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">n_cols</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">n_cols</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Boxplot de </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/867e29453751412c12cb69b143c1cfd6a24b9dafd0c88a6ad72a813f3f4b6d3f.png" src="_images/867e29453751412c12cb69b143c1cfd6a24b9dafd0c88a6ad72a813f3f4b6d3f.png" />
</div>
</div>
<ul class="simple">
<li><p>La velocidad horaria es en promedio 3, presenta datos atipicos.</p></li>
<li><p>La temperatura en pomedio esta en 23 grados y presenta valores atipicos para cada bigote.</p></li>
<li><p>La presion atmosferica no presenta mucha variabilidad.</p></li>
<li><p>La humeda relativa esta sesgazada a la derecha.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;direccion horaria viento&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;temperatura max hora anterior&#39;</span><span class="p">,</span> <span class="s1">&#39;humedad relativa horaria&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;presion atmosférica a nivel de estacion&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)))</span>

<span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
    
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;velocidad horaria viento&#39;</span><span class="p">,</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">},</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Regplot de </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>   
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/842038992954164676a79066ce9c1cc3aa9922ddcd52b219f8cd3d0e7e36b277.png" src="_images/842038992954164676a79066ce9c1cc3aa9922ddcd52b219f8cd3d0e7e36b277.png" />
</div>
</div>
<p>Se identifica lo siguiente:</p>
<ul class="simple">
<li><p>Una mayor temperatura no afecta sustancialmente la velocidad del viento.</p></li>
<li><p>Al incrementar la humedad relativa tambien aumenta la velocidad del viento.</p></li>
<li><p>A mayor humedad relativa menor sera la velocidad del viento.</p></li>
<li><p>La presion atmosferica a nivel de estacion aumenta directamente la velocidad horaria del viento.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>   
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.1f&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">},</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7f16b6abf675d3b6a52f4214c4a1ef25a459a429d1b6761fdd326cead48c155c.png" src="_images/7f16b6abf675d3b6a52f4214c4a1ef25a459a429d1b6761fdd326cead48c155c.png" />
</div>
</div>
<p>Se observa que hay variables con correlaciones de 1, esto es, estan altamente relacionadas y por lo tanto son redundantes para el modelo. Se decide entonces utilizar el método VIF (Variance Inflation Factor) para identificar la multicolinealidad en un conjunto de datos y reducirla. Valores de VIF por encima de 5-10 sugiere que hay multicolinealidad alta entre la variable y al menos una otra variable y por lo tanto debe de ser removida del modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_vif</span> <span class="o">=</span> <span class="n">df</span>
<span class="n">df_vif</span><span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;velocidad horaria viento&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df_vif</span> <span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_vif</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                    feature        VIF
0                                      hora   1.535066
1                  direccion horaria viento   1.312001
2            humedad rel. max hora anterior  77.951749
3            humedad rel. min hora anterior  80.849151
4             temperatura max hora anterior  68.492554
5             temperatura min hora anterior  57.283224
6                  humedad relativa horaria  51.851514
7   presion atmosférica a nivel de estacion   4.900754
8             precipitacion total por hora    1.122183
9                  maxima rafaga de viento    1.325654
10                  presion atmosferica max  16.065974
11                  presion atmosferica min  16.499324
</pre></div>
</div>
</div>
</div>
<p>Se removera la columna humedad rel. min hora anterior pues esta presenta el VIF más grande.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_vif</span><span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;humedad rel. min hora anterior&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_vif</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                    feature        VIF
0                                      hora   1.529583
1                  direccion horaria viento   1.311674
2            humedad rel. max hora anterior  41.754347
3             temperatura max hora anterior  30.834055
4             temperatura min hora anterior  26.788844
5                  humedad relativa horaria  46.388935
6   presion atmosférica a nivel de estacion   4.900632
7             precipitacion total por hora    1.122181
8                  maxima rafaga de viento    1.325499
9                   presion atmosferica max  16.044685
10                  presion atmosferica min  16.492733
</pre></div>
</div>
</div>
</div>
<p>La variable humedad rel. max hora anterior se remueve del dataframe puesto que es la que mayor VIF presenta (41.75)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_vif</span><span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;humedad rel. max hora anterior&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_vif</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                   feature        VIF
0                                     hora   1.529426
1                 direccion horaria viento   1.311637
2            temperatura max hora anterior  24.599178
3            temperatura min hora anterior  21.533187
4                 humedad relativa horaria   2.446961
5  presion atmosférica a nivel de estacion   4.900491
6            precipitacion total por hora    1.105983
7                 maxima rafaga de viento    1.325406
8                  presion atmosferica max  16.030280
9                  presion atmosferica min  16.490573
</pre></div>
</div>
</div>
</div>
<p>La columna temperatura max hora anterior se elimina del modelo por tener el VIF mayor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_vif</span><span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;temperatura max hora anterior&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_vif</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                   feature        VIF
0                                     hora   1.464874
1                 direccion horaria viento   1.286975
2            temperatura min hora anterior   2.240830
3                 humedad relativa horaria   2.252262
4  presion atmosférica a nivel de estacion   4.900068
5            precipitacion total por hora    1.074089
6                 maxima rafaga de viento    1.315053
7                  presion atmosferica max  15.726554
8                  presion atmosferica min  16.212432
</pre></div>
</div>
</div>
</div>
<p>Se elimina la columna presion atmosferica min debido a que tiene el VIF mas grande entre las variables presentes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_vif</span><span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;presion atmosferica min&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_vif</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_vif</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                   feature       VIF
0                                     hora  1.449601
1                 direccion horaria viento  1.282038
2            temperatura min hora anterior  2.235192
3                 humedad relativa horaria  2.246231
4  presion atmosférica a nivel de estacion  4.552538
5            precipitacion total por hora   1.069973
6                 maxima rafaga de viento   1.315007
7                  presion atmosferica max  4.757647
</pre></div>
</div>
</div>
</div>
<p>No hay variable con VIF &gt;5 por lo que se concluye que no hay variables que esten altamentes correlacionadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;humedad rel. min hora anterior&quot;</span><span class="p">,</span><span class="s2">&quot;humedad rel. max hora anterior&quot;</span><span class="p">,</span>
         <span class="s2">&quot;temperatura max hora anterior&quot;</span><span class="p">,</span><span class="s2">&quot;presion atmosferica min&quot;</span><span class="p">,</span><span class="s2">&quot;presion atmosferica min&quot;</span><span class="p">],</span>
        <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 87693 entries, 0 to 87692
Data columns (total 9 columns):
 #   Column                                   Non-Null Count  Dtype  
---  ------                                   --------------  -----  
 0   hora                                     87693 non-null  int64  
 1   direccion horaria viento                 87693 non-null  float64
 2   velocidad horaria viento                 87693 non-null  float64
 3   temperatura min hora anterior            87693 non-null  float64
 4   humedad relativa horaria                 87693 non-null  float64
 5   presion atmosférica a nivel de estacion  87693 non-null  float64
 6   precipitacion total por hora             87693 non-null  float64
 7   maxima rafaga de viento                  87693 non-null  float64
 8   presion atmosferica max                  87693 non-null  float64
dtypes: float64(8), int64(1)
memory usage: 6.0 MB
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="datos-fraud-detection">
<h2>Datos Fraud Detection<a class="headerlink" href="#datos-fraud-detection" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">klib</span>
<span class="n">load_path1</span><span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\danie\OneDrive\Documentos\train_transaction.csv&quot;</span>
<span class="n">load_path2</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;C:\Users\danie\OneDrive\Documentos\train_identity.csv&quot;</span>
<span class="n">df1</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">load_path1</span><span class="p">)</span>
<span class="n">df2</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">load_path2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s2">&quot;TransactionID&quot;</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 590540 entries, 0 to 590539
Columns: 434 entries, TransactionID to DeviceInfo
dtypes: float64(399), int64(4), object(31)
memory usage: 1.9+ GB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;TransactionID&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>El DataFrame tiene 590,540 filas, contiene 434 columnas, es decir, 434 características o variables diferentes para cada observación.</p>
<p>Tipos de datos:</p>
<ul class="simple">
<li><p>Float64: 399 de las columnas contienen datos de tipo decimal.</p></li>
<li><p>Int64: 4 de las columnas contienen datos enteros.</p></li>
<li><p>Object: 31 columnas contienen datos de tipo objeto.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reduce_mem_usage</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>

    <span class="n">start_mem</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">start_mem_GB</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Initial memory usage of dataframe is </span><span class="si">{</span><span class="n">start_mem</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> MB/</span><span class="si">{</span><span class="n">start_mem_GB</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> GB&#39;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">col_type</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
        
        <span class="k">if</span> <span class="n">col_type</span> <span class="o">!=</span> <span class="nb">object</span><span class="p">:</span>
            <span class="n">c_min</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">c_max</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col_type</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>  
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

    <span class="n">end_mem</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">end_mem_GB</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
    <span class="n">reduction</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">start_mem</span> <span class="o">-</span> <span class="n">end_mem</span><span class="p">)</span> <span class="o">/</span> <span class="n">start_mem</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Memory usage after optimization is: </span><span class="si">{</span><span class="n">end_mem</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> MB/</span><span class="si">{</span><span class="n">end_mem_GB</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> GB&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Decreased by </span><span class="si">{</span><span class="n">reduction</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span> <span class="o">=</span> <span class="n">reduce_mem_usage</span><span class="p">(</span><span class="n">df_f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial memory usage of dataframe is 2567.09 MB/2.51 GB
Memory usage after optimization is: 527.95 MB/0.52 GB
Decreased by 79.4%
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df_f</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_f</span><span class="p">)))</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>isFraud            0.000000
TransactionDT      0.000000
TransactionAmt     0.000000
ProductCD          0.000000
card1              0.000000
                    ...    
id_36             76.126088
id_37             76.126088
id_38             76.126088
DeviceType        76.155722
DeviceInfo        79.905510
Length: 433, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Se observa que hay variables con hasta 80% de valores faltantes, se decide remover del modelo aquellas variables que tengan 40% o mas de valores faltantes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_f</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.4</span>
<span class="n">df_f</span> <span class="o">=</span> <span class="n">df_f</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df_f</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_f</span><span class="p">)))</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>isFraud           0.000000
TransactionDT     0.000000
TransactionAmt    0.000000
ProductCD         0.000000
card1             0.000000
                    ...   
V317              0.002032
V318              0.002032
V319              0.002032
V320              0.002032
V321              0.002032
Length: 225, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Se redujo el modelo el dataframe de un total de 434 columnas a 226.</p>
<p>Se realizara la imputacion de los valores numericos que tienen faltantes con el imputer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">df_f</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="n">non_numeric_cols</span> <span class="o">=</span> <span class="n">df_f</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="n">df_copy</span> <span class="o">=</span> <span class="n">df_f</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>

<span class="n">df_copy</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_f</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span> <span class="o">=</span> <span class="n">df_copy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df_f</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_f</span><span class="p">)))</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>isFraud           0.0
TransactionDT     0.0
TransactionAmt    0.0
card1             0.0
card2             0.0
                 ... 
V317              0.0
V318              0.0
V319              0.0
V320              0.0
V321              0.0
Length: 212, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df_f</span><span class="p">[</span><span class="n">non_numeric_cols</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_f</span><span class="p">)))</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ProductCD         0.000000
card4             0.267044
card6             0.266028
P_emaildomain    15.994852
M1               45.907136
M2               45.907136
M3               45.907136
M4               47.658753
M5               59.349409
M6               28.678836
M7               58.635317
M8               58.633115
M9               58.633115
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Se procede a eliminar las filas que tengan valores faltantes dentro de las variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span> <span class="o">=</span> <span class="n">df_f</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">non_numeric_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df_f</span><span class="p">[</span><span class="n">non_numeric_cols</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_f</span><span class="p">)))</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ProductCD        0.0
card4            0.0
card6            0.0
P_emaildomain    0.0
M1               0.0
M2               0.0
M3               0.0
M4               0.0
M5               0.0
M6               0.0
M7               0.0
M8               0.0
M9               0.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">chi2_contingency</span>

<span class="k">def</span> <span class="nf">chi2_test_for_all_pairs</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
  
    <span class="n">categorical_columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">([</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
    
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Iterar sobre cada par de columnas categóricas</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">categorical_columns</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">categorical_columns</span><span class="p">)):</span>
            <span class="n">col1</span> <span class="o">=</span> <span class="n">categorical_columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">col2</span> <span class="o">=</span> <span class="n">categorical_columns</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            
            <span class="c1"># Crear tabla de contingencia</span>
            <span class="n">contingency_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col1</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">col2</span><span class="p">])</span>
            
            <span class="c1"># Realizar la prueba chi2</span>
            <span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">chi2_contingency</span><span class="p">(</span><span class="n">contingency_table</span><span class="p">)</span>
            
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Variable 1&#39;</span><span class="p">:</span> <span class="n">col1</span><span class="p">,</span>
                <span class="s1">&#39;Variable 2&#39;</span><span class="p">:</span> <span class="n">col2</span><span class="p">,</span>
                <span class="s1">&#39;Chi2 Statistic&#39;</span><span class="p">:</span> <span class="n">chi2</span><span class="p">,</span>
                <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p</span>
            <span class="p">})</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chi2_test_for_all_pairs</span><span class="p">(</span><span class="n">df_f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Variable 1</th>
      <th>Variable 2</th>
      <th>Chi2 Statistic</th>
      <th>p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ProductCD</td>
      <td>card4</td>
      <td>0.000000</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ProductCD</td>
      <td>card6</td>
      <td>0.000000</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ProductCD</td>
      <td>P_emaildomain</td>
      <td>0.000000</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ProductCD</td>
      <td>M1</td>
      <td>0.000000</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ProductCD</td>
      <td>M2</td>
      <td>0.000000</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>73</th>
      <td>M6</td>
      <td>M8</td>
      <td>656.785713</td>
      <td>7.470747e-145</td>
    </tr>
    <tr>
      <th>74</th>
      <td>M6</td>
      <td>M9</td>
      <td>858.962353</td>
      <td>8.187359e-189</td>
    </tr>
    <tr>
      <th>75</th>
      <td>M7</td>
      <td>M8</td>
      <td>27707.428312</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>76</th>
      <td>M7</td>
      <td>M9</td>
      <td>3393.410273</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>77</th>
      <td>M8</td>
      <td>M9</td>
      <td>11323.819204</td>
      <td>0.000000e+00</td>
    </tr>
  </tbody>
</table>
<p>78 rows × 4 columns</p>
</div></div></div>
</div>
<p>Se observa que la variable M7 esta relacionada con M8 ( valor p=0), y a la vez m7 esta relacionada con M9, al igual que M8 con M9, por lo que se removeran M8 y M9.
M1 esta relacionada con M2-M9 por lo que se remueven el resto de M.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;M2&quot;</span><span class="p">,</span> <span class="s2">&quot;M3&quot;</span><span class="p">,</span> <span class="s2">&quot;M4&quot;</span><span class="p">,</span> <span class="s2">&quot;M5&quot;</span><span class="p">,</span> <span class="s2">&quot;M6&quot;</span><span class="p">,</span> <span class="s2">&quot;M7&quot;</span><span class="p">,</span> <span class="s2">&quot;M8&quot;</span><span class="p">,</span> <span class="s2">&quot;M9&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;isFraud&#39;, &#39;TransactionDT&#39;, &#39;TransactionAmt&#39;, &#39;ProductCD&#39;, &#39;card1&#39;,
       &#39;card2&#39;, &#39;card3&#39;, &#39;card4&#39;, &#39;card5&#39;, &#39;card6&#39;,
       ...
       &#39;V312&#39;, &#39;V313&#39;, &#39;V314&#39;, &#39;V315&#39;, &#39;V316&#39;, &#39;V317&#39;, &#39;V318&#39;, &#39;V319&#39;, &#39;V320&#39;,
       &#39;V321&#39;],
      dtype=&#39;object&#39;, length=217)
</pre></div>
</div>
</div>
</div>
<p>La variable del modelo “V”, dice ofrecer una gran variedad de funciones, como la clasificación, el recuento y otras relaciones entre entidades, sin embargo, ya que no se cuenta con entendimiento mayor de que a que se refiere. Adicionalmente causa que el dataframe sea extenso sin ser necesario (Hay 180 columnas de Vxxx en el dataframe) por lo que sera removido.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_f</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">)]</span>
<span class="n">num_columns_to_drop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns_to_drop</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">columns_to_drop</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of columns to drop: </span><span class="si">{</span><span class="n">num_columns_to_drop</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;V1&#39;, &#39;V2&#39;, &#39;V3&#39;, &#39;V4&#39;, &#39;V5&#39;, &#39;V6&#39;, &#39;V7&#39;, &#39;V8&#39;, &#39;V9&#39;, &#39;V10&#39;, &#39;V11&#39;, &#39;V12&#39;, &#39;V13&#39;, &#39;V14&#39;, &#39;V15&#39;, &#39;V16&#39;, &#39;V17&#39;, &#39;V18&#39;, &#39;V19&#39;, &#39;V20&#39;, &#39;V21&#39;, &#39;V22&#39;, &#39;V23&#39;, &#39;V24&#39;, &#39;V25&#39;, &#39;V26&#39;, &#39;V27&#39;, &#39;V28&#39;, &#39;V29&#39;, &#39;V30&#39;, &#39;V31&#39;, &#39;V32&#39;, &#39;V33&#39;, &#39;V34&#39;, &#39;V35&#39;, &#39;V36&#39;, &#39;V37&#39;, &#39;V38&#39;, &#39;V39&#39;, &#39;V40&#39;, &#39;V41&#39;, &#39;V42&#39;, &#39;V43&#39;, &#39;V44&#39;, &#39;V45&#39;, &#39;V46&#39;, &#39;V47&#39;, &#39;V48&#39;, &#39;V49&#39;, &#39;V50&#39;, &#39;V51&#39;, &#39;V52&#39;, &#39;V53&#39;, &#39;V54&#39;, &#39;V55&#39;, &#39;V56&#39;, &#39;V57&#39;, &#39;V58&#39;, &#39;V59&#39;, &#39;V60&#39;, &#39;V61&#39;, &#39;V62&#39;, &#39;V63&#39;, &#39;V64&#39;, &#39;V65&#39;, &#39;V66&#39;, &#39;V67&#39;, &#39;V68&#39;, &#39;V69&#39;, &#39;V70&#39;, &#39;V71&#39;, &#39;V72&#39;, &#39;V73&#39;, &#39;V74&#39;, &#39;V75&#39;, &#39;V76&#39;, &#39;V77&#39;, &#39;V78&#39;, &#39;V79&#39;, &#39;V80&#39;, &#39;V81&#39;, &#39;V82&#39;, &#39;V83&#39;, &#39;V84&#39;, &#39;V85&#39;, &#39;V86&#39;, &#39;V87&#39;, &#39;V88&#39;, &#39;V89&#39;, &#39;V90&#39;, &#39;V91&#39;, &#39;V92&#39;, &#39;V93&#39;, &#39;V94&#39;, &#39;V95&#39;, &#39;V96&#39;, &#39;V97&#39;, &#39;V98&#39;, &#39;V99&#39;, &#39;V100&#39;, &#39;V101&#39;, &#39;V102&#39;, &#39;V103&#39;, &#39;V104&#39;, &#39;V105&#39;, &#39;V106&#39;, &#39;V107&#39;, &#39;V108&#39;, &#39;V109&#39;, &#39;V110&#39;, &#39;V111&#39;, &#39;V112&#39;, &#39;V113&#39;, &#39;V114&#39;, &#39;V115&#39;, &#39;V116&#39;, &#39;V117&#39;, &#39;V118&#39;, &#39;V119&#39;, &#39;V120&#39;, &#39;V121&#39;, &#39;V122&#39;, &#39;V123&#39;, &#39;V124&#39;, &#39;V125&#39;, &#39;V126&#39;, &#39;V127&#39;, &#39;V128&#39;, &#39;V129&#39;, &#39;V130&#39;, &#39;V131&#39;, &#39;V132&#39;, &#39;V133&#39;, &#39;V134&#39;, &#39;V135&#39;, &#39;V136&#39;, &#39;V137&#39;, &#39;V279&#39;, &#39;V280&#39;, &#39;V281&#39;, &#39;V282&#39;, &#39;V283&#39;, &#39;V284&#39;, &#39;V285&#39;, &#39;V286&#39;, &#39;V287&#39;, &#39;V288&#39;, &#39;V289&#39;, &#39;V290&#39;, &#39;V291&#39;, &#39;V292&#39;, &#39;V293&#39;, &#39;V294&#39;, &#39;V295&#39;, &#39;V296&#39;, &#39;V297&#39;, &#39;V298&#39;, &#39;V299&#39;, &#39;V300&#39;, &#39;V301&#39;, &#39;V302&#39;, &#39;V303&#39;, &#39;V304&#39;, &#39;V305&#39;, &#39;V306&#39;, &#39;V307&#39;, &#39;V308&#39;, &#39;V309&#39;, &#39;V310&#39;, &#39;V311&#39;, &#39;V312&#39;, &#39;V313&#39;, &#39;V314&#39;, &#39;V315&#39;, &#39;V316&#39;, &#39;V317&#39;, &#39;V318&#39;, &#39;V319&#39;, &#39;V320&#39;, &#39;V321&#39;]
Number of columns to drop: 180
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span> <span class="o">=</span> <span class="n">df_f</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns_to_drop</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 104194 entries, 2 to 590536
Data columns (total 37 columns):
 #   Column          Non-Null Count   Dtype   
---  ------          --------------   -----   
 0   isFraud         104194 non-null  float64 
 1   TransactionDT   104194 non-null  float64 
 2   TransactionAmt  104194 non-null  float64 
 3   ProductCD       104194 non-null  category
 4   card1           104194 non-null  float64 
 5   card2           104194 non-null  float64 
 6   card3           104194 non-null  float64 
 7   card4           104194 non-null  category
 8   card5           104194 non-null  float64 
 9   card6           104194 non-null  category
 10  addr1           104194 non-null  float64 
 11  addr2           104194 non-null  float64 
 12  dist1           104194 non-null  float64 
 13  P_emaildomain   104194 non-null  category
 14  C1              104194 non-null  float64 
 15  C2              104194 non-null  float64 
 16  C3              104194 non-null  float64 
 17  C4              104194 non-null  float64 
 18  C5              104194 non-null  float64 
 19  C6              104194 non-null  float64 
 20  C7              104194 non-null  float64 
 21  C8              104194 non-null  float64 
 22  C9              104194 non-null  float64 
 23  C10             104194 non-null  float64 
 24  C11             104194 non-null  float64 
 25  C12             104194 non-null  float64 
 26  C13             104194 non-null  float64 
 27  C14             104194 non-null  float64 
 28  D1              104194 non-null  float64 
 29  D2              104194 non-null  float64 
 30  D3              104194 non-null  float64 
 31  D4              104194 non-null  float64 
 32  D5              104194 non-null  float64 
 33  D10             104194 non-null  float64 
 34  D11             104194 non-null  float64 
 35  D15             104194 non-null  float64 
 36  M1              104194 non-null  category
dtypes: category(5), float64(32)
memory usage: 26.7 MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">non_numeric_columns</span> <span class="o">=</span> <span class="n">df_f</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">non_numeric_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       ProductCD       card4   card6 P_emaildomain M1
2              W        visa   debit   outlook.com  T
6              W        visa   debit     yahoo.com  T
20             W  mastercard   debit     gmail.com  T
42             W        visa   debit     gmail.com  T
46             W        visa   debit     gmail.com  T
...          ...         ...     ...           ... ..
590517         W        visa  credit   hotmail.com  T
590520         W        visa   debit     yahoo.com  T
590522         W        visa   debit     gmail.com  T
590524         W  mastercard   debit     gmail.com  T
590536         W  mastercard   debit     gmail.com  T

[104194 rows x 5 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unique_values</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">non_numeric_columns</span><span class="p">:</span>
    <span class="n">unique_values</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_f</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="n">unique_values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ProductCD&#39;: [&#39;W&#39;]
 Categories (5, object): [&#39;C&#39;, &#39;H&#39;, &#39;R&#39;, &#39;S&#39;, &#39;W&#39;],
 &#39;card4&#39;: [&#39;visa&#39;, &#39;mastercard&#39;, &#39;discover&#39;]
 Categories (4, object): [&#39;american express&#39;, &#39;discover&#39;, &#39;mastercard&#39;, &#39;visa&#39;],
 &#39;card6&#39;: [&#39;debit&#39;, &#39;credit&#39;, &#39;debit or credit&#39;]
 Categories (4, object): [&#39;charge card&#39;, &#39;credit&#39;, &#39;debit&#39;, &#39;debit or credit&#39;],
 &#39;P_emaildomain&#39;: [&#39;outlook.com&#39;, &#39;yahoo.com&#39;, &#39;gmail.com&#39;, &#39;hotmail.com&#39;, &#39;ymail.com&#39;, ..., &#39;yahoo.es&#39;, &#39;yahoo.com.mx&#39;, &#39;hotmail.es&#39;, &#39;yahoo.de&#39;, &#39;hotmail.fr&#39;]
 Length: 49
 Categories (59, object): [&#39;aim.com&#39;, &#39;anonymous.com&#39;, &#39;aol.com&#39;, &#39;att.net&#39;, ..., &#39;yahoo.de&#39;, &#39;yahoo.es&#39;, &#39;yahoo.fr&#39;, &#39;ymail.com&#39;],
 &#39;M1&#39;: [&#39;T&#39;, &#39;F&#39;]
 Categories (2, object): [&#39;F&#39;, &#39;T&#39;]}
</pre></div>
</div>
</div>
</div>
<p>Se eliminaran las columnas:</p>
<ul class="simple">
<li><p>Card4, es igual que la variable card6 pero le hace falta un tipo de tarjeta.</p></li>
<li><p>P_emaildomain ya que cuenta con 49 tipos de correos distintos y no son de relevancia.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;card4&quot;</span><span class="p">,</span><span class="s2">&quot;P_emaildomain&quot;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Se utilizará el método VIF (Variance Inflation Factor), para reducir la multicorrelacion entre variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">df_f</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>

<span class="n">df_new</span> <span class="o">=</span> <span class="n">df_f</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span>
<span class="n">df_new</span><span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;isFraud&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df_new</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           feature         VIF
0    TransactionDT    1.058000
1   TransactionAmt    1.008020
2            card1    1.006558
3            card2    1.008217
4            card3    1.001092
5            card5    1.020566
6            addr1    1.004651
7            addr2    1.000136
8            dist1    1.018174
9               C1  205.750188
10              C2   86.931570
11              C3         NaN
12              C4         NaN
13              C5   12.378506
14              C6   41.806527
15              C7         NaN
16              C8         NaN
17              C9   50.036354
18             C10         NaN
19             C11  141.216938
20             C12    1.131900
21             C13   13.566563
22             C14  112.922990
23              D1    6.871977
24              D2    5.225816
25              D3    1.497753
26              D4    2.764823
27              D5    1.564188
28             D10    2.073638
29             D11    2.392962
30             D15    3.493695
</pre></div>
</div>
</div>
</div>
<p>Antes de proceder a eliminar variables con alta multicolinealidad se removeran aquellas variables con un VIF de NaN puesto que no aportan información y deben ser eliminadas del conjunto de datos antes del análisis, esto ya que su varianza es y por eso retorna NaN.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span><span class="s2">&quot;C4&quot;</span><span class="p">,</span><span class="s2">&quot;C7&quot;</span><span class="p">,</span><span class="s2">&quot;C8&quot;</span><span class="p">,</span><span class="s2">&quot;C10&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">df_f</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>

<span class="n">df_new</span> <span class="o">=</span> <span class="n">df_f</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span>
<span class="n">df_new</span><span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;isFraud&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df_new</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           feature         VIF
0    TransactionDT    1.058000
1   TransactionAmt    1.008020
2            card1    1.006558
3            card2    1.008217
4            card3    1.001092
5            card5    1.020566
6            addr1    1.004651
7            addr2    1.000136
8            dist1    1.018174
9               C1  205.750188
10              C2   86.931570
11              C5   12.378506
12              C6   41.806527
13              C9   50.036354
14             C11  141.216938
15             C12    1.131900
16             C13   13.566563
17             C14  112.922990
18              D1    6.871977
19              D2    5.225816
20              D3    1.497753
21              D4    2.764823
22              D5    1.564188
23             D10    2.073638
24             D11    2.392962
25             D15    3.493695
</pre></div>
</div>
</div>
</div>
<p>Se eliminara la variable C1 puesto que tiene el valor VIF mas alto.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_new</span><span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;C1&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Calculate VIF</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           feature         VIF
0    TransactionDT    1.057745
1   TransactionAmt    1.005964
2            card1    1.006557
3            card2    1.008193
4            card3    1.001075
5            card5    1.020479
6            addr1    1.004430
7            addr2    1.000136
8            dist1    1.018163
9               C2   86.903986
10              C5   12.356660
11              C6   40.792482
12              C9   49.996886
13             C11  106.351999
14             C12    1.131253
15             C13   13.382130
16             C14   54.847704
17              D1    6.772442
18              D2    5.215653
19              D3    1.495528
20              D4    2.749037
21              D5    1.550689
22             D10    2.070787
23             D11    2.390836
24             D15    3.465711
</pre></div>
</div>
</div>
</div>
<p>Se eliminara la variable C11 (VIF 106)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_new</span><span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;C11&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Calculate VIF</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           feature        VIF
0    TransactionDT   1.056313
1   TransactionAmt   1.005788
2            card1   1.006545
3            card2   1.008103
4            card3   1.001018
5            card5   1.020453
6            addr1   1.004418
7            addr2   1.000135
8            dist1   1.016906
9               C2  57.548617
10              C5  12.197122
11              C6  32.998171
12              C9  45.630443
13             C12   1.131147
14             C13  12.669180
15             C14  53.433264
16              D1   6.753756
17              D2   5.178326
18              D3   1.495186
19              D4   2.745300
20              D5   1.550195
21             D10   2.024215
22             D11   2.390787
23             D15   3.334946
</pre></div>
</div>
</div>
</div>
<p>Se eliminara la variable C2 (VIF 57.5)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_new</span><span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;C2&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Calculate VIF</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           feature        VIF
0    TransactionDT   1.056301
1   TransactionAmt   1.005608
2            card1   1.006498
3            card2   1.008088
4            card3   1.001013
5            card5   1.020453
6            addr1   1.004239
7            addr2   1.000135
8            dist1   1.016743
9               C5  11.984986
10              C6  22.854785
11              C9  43.955554
12             C12   1.130235
13             C13  12.665526
14             C14  45.983001
15              D1   6.729330
16              D2   5.177654
17              D3   1.493672
18              D4   2.736933
19              D5   1.550178
20             D10   1.944956
21             D11   2.388690
22             D15   3.332897
</pre></div>
</div>
</div>
</div>
<p>Se eliminara la variable C14 (VIF 45.9)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_new</span><span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;C14&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Calculate VIF</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           feature        VIF
0    TransactionDT   1.054325
1   TransactionAmt   1.005189
2            card1   1.006160
3            card2   1.007890
4            card3   1.000988
5            card5   1.020066
6            addr1   1.004119
7            addr2   1.000134
8            dist1   1.016558
9               C5  10.761787
10              C6  20.478546
11              C9  30.641297
12             C12   1.125205
13             C13  12.378393
14              D1   6.662580
15              D2   5.177310
16              D3   1.484221
17              D4   2.720760
18              D5   1.547123
19             D10   1.944899
20             D11   2.375893
21             D15   3.329398
</pre></div>
</div>
</div>
</div>
<p>Se elimina la columna C9 (VIF 30.6  )</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_new</span><span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;C9&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Calculate VIF</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           feature        VIF
0    TransactionDT   1.051455
1   TransactionAmt   1.005124
2            card1   1.006083
3            card2   1.007843
4            card3   1.000988
5            card5   1.019922
6            addr1   1.004110
7            addr2   1.000134
8            dist1   1.015435
9               C5   9.776789
10              C6   5.759737
11             C12   1.124706
12             C13  11.780364
13              D1   6.662431
14              D2   5.177076
15              D3   1.483937
16              D4   2.706497
17              D5   1.546785
18             D10   1.944874
19             D11   2.344723
20             D15   3.329063
</pre></div>
</div>
</div>
</div>
<p>Se elimina la columna C13 (VIF 11.78)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_new</span><span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;C13&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Calculate VIF</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           feature       VIF
0    TransactionDT  1.049659
1   TransactionAmt  1.003928
2            card1  1.006049
3            card2  1.007842
4            card3  1.000978
5            card5  1.019686
6            addr1  1.003595
7            addr2  1.000134
8            dist1  1.015251
9               C5  4.727249
10              C6  4.778186
11             C12  1.102684
12              D1  6.633770
13              D2  5.176115
14              D3  1.467122
15              D4  2.685360
16              D5  1.525899
17             D10  1.937616
18             D11  2.303521
19             D15  3.328903
</pre></div>
</div>
</div>
</div>
<p>Se elimina la columna D1 (VIF 6.6</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_new</span><span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;D1&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Calculate VIF</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">vif_data</span> <span class="o">=</span> <span class="n">vif_data</span><span class="p">[</span><span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;const&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           feature       VIF
0    TransactionDT  1.049193
1   TransactionAmt  1.003910
2            card1  1.006041
3            card2  1.007772
4            card3  1.000867
5            card5  1.018383
6            addr1  1.003477
7            addr2  1.000131
8            dist1  1.013704
9               C5  4.725787
10              C6  4.774172
11             C12  1.074314
12              D2  1.540065
13              D3  1.287921
14              D4  2.647147
15              D5  1.439623
16             D10  1.931183
17             D11  2.290733
18             D15  3.271063
</pre></div>
</div>
</div>
</div>
<p>No hay variable con VIF superior o igual a 5 por lo que hay mas variables que presenten una alta multicolinealidad entre si.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span><span class="s2">&quot;C11&quot;</span><span class="p">,</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span><span class="s2">&quot;C14&quot;</span><span class="p">,</span><span class="s2">&quot;C9&quot;</span><span class="p">,</span><span class="s2">&quot;C13&quot;</span><span class="p">,</span><span class="s2">&quot;D1&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 104194 entries, 2 to 590536
Data columns (total 23 columns):
 #   Column          Non-Null Count   Dtype   
---  ------          --------------   -----   
 0   isFraud         104194 non-null  float64 
 1   TransactionDT   104194 non-null  float64 
 2   TransactionAmt  104194 non-null  float64 
 3   ProductCD       104194 non-null  category
 4   card1           104194 non-null  float64 
 5   card2           104194 non-null  float64 
 6   card3           104194 non-null  float64 
 7   card5           104194 non-null  float64 
 8   card6           104194 non-null  category
 9   addr1           104194 non-null  float64 
 10  addr2           104194 non-null  float64 
 11  dist1           104194 non-null  float64 
 12  C5              104194 non-null  float64 
 13  C6              104194 non-null  float64 
 14  C12             104194 non-null  float64 
 15  D2              104194 non-null  float64 
 16  D3              104194 non-null  float64 
 17  D4              104194 non-null  float64 
 18  D5              104194 non-null  float64 
 19  D10             104194 non-null  float64 
 20  D11             104194 non-null  float64 
 21  D15             104194 non-null  float64 
 22  M1              104194 non-null  category
dtypes: category(3), float64(20)
memory usage: 17.0 MB
</pre></div>
</div>
</div>
</div>
<p>Se procede a hacer onehotencoding de las variables categoricas para que puedan ser usadas en los modelos de machine learning.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns_to_encode</span>  <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ProductCD&quot;</span><span class="p">,</span> <span class="s2">&quot;card6&quot;</span><span class="p">,</span> <span class="s2">&quot;M1&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>

<span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">data_encoded</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_f</span><span class="p">[</span><span class="n">columns_to_encode</span><span class="p">])</span>
<span class="n">encoded_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_encoded</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">encoder</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">columns_to_encode</span><span class="p">))</span>

<span class="c1"># Resetting the index before concatenation</span>
<span class="n">df_f_dropped</span> <span class="o">=</span> <span class="n">df_f</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns_to_encode</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_f_encoded</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_f_dropped</span><span class="p">,</span> <span class="n">encoded_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span> <span class="o">=</span> <span class="n">df_f_encoded</span>
</pre></div>
</div>
</div>
</div>
<p>Tras haber realizado una limpieza del dataframe finalmente se prosigue al analisis como tal.</p>
<section id="id1">
<h3>Descripcion del tipo de variables<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 104194 entries, 0 to 104193
Data columns (total 26 columns):
 #   Column                 Non-Null Count   Dtype  
---  ------                 --------------   -----  
 0   isFraud                104194 non-null  float64
 1   TransactionDT          104194 non-null  float64
 2   TransactionAmt         104194 non-null  float64
 3   card1                  104194 non-null  float64
 4   card2                  104194 non-null  float64
 5   card3                  104194 non-null  float64
 6   card5                  104194 non-null  float64
 7   addr1                  104194 non-null  float64
 8   addr2                  104194 non-null  float64
 9   dist1                  104194 non-null  float64
 10  C5                     104194 non-null  float64
 11  C6                     104194 non-null  float64
 12  C12                    104194 non-null  float64
 13  D2                     104194 non-null  float64
 14  D3                     104194 non-null  float64
 15  D4                     104194 non-null  float64
 16  D5                     104194 non-null  float64
 17  D10                    104194 non-null  float64
 18  D11                    104194 non-null  float64
 19  D15                    104194 non-null  float64
 20  ProductCD_W            104194 non-null  float64
 21  card6_credit           104194 non-null  float64
 22  card6_debit            104194 non-null  float64
 23  card6_debit or credit  104194 non-null  float64
 24  M1_F                   104194 non-null  float64
 25  M1_T                   104194 non-null  float64
dtypes: float64(26)
memory usage: 20.7 MB
</pre></div>
</div>
</div>
</div>
<p>Las variables TransactionDt y TransactionAmt se removeran del dataframe, por otro lado, las variables address y distancia seran removidas tambien porque se cuenta con informacion del pais donde fue hecha la transaccion, por lo tanto redundan.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;TransactionDT&quot;</span><span class="p">,</span><span class="s2">&quot;TransactionAmt&quot;</span><span class="p">,</span><span class="s2">&quot;addr1&quot;</span><span class="p">,</span><span class="s2">&quot;addr2&quot;</span><span class="p">,</span><span class="s2">&quot;dist1&quot;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="calcular-numero-de-observaciones-media-desviacion-estandar-minimo-maximo-cuartiles">
<h3>Calcular número de observaciones, media, desviación estándar, mínimo, máximo, cuartiles<a class="headerlink" href="#calcular-numero-de-observaciones-media-desviacion-estandar-minimo-maximo-cuartiles" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>isFraud</th>
      <td>104194.0</td>
      <td>0.031249</td>
      <td>0.173992</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>card1</th>
      <td>104194.0</td>
      <td>9892.715473</td>
      <td>4808.434119</td>
      <td>1004.0</td>
      <td>6311.5</td>
      <td>9653.0</td>
      <td>13663.0</td>
      <td>18393.0</td>
    </tr>
    <tr>
      <th>card2</th>
      <td>104194.0</td>
      <td>353.118231</td>
      <td>153.390421</td>
      <td>100.0</td>
      <td>206.0</td>
      <td>360.0</td>
      <td>490.0</td>
      <td>600.0</td>
    </tr>
    <tr>
      <th>card3</th>
      <td>104194.0</td>
      <td>150.001238</td>
      <td>0.908916</td>
      <td>100.0</td>
      <td>150.0</td>
      <td>150.0</td>
      <td>150.0</td>
      <td>231.0</td>
    </tr>
    <tr>
      <th>card5</th>
      <td>104194.0</td>
      <td>201.068948</td>
      <td>39.923421</td>
      <td>100.0</td>
      <td>166.0</td>
      <td>226.0</td>
      <td>226.0</td>
      <td>235.0</td>
    </tr>
    <tr>
      <th>C5</th>
      <td>104194.0</td>
      <td>1.573315</td>
      <td>13.738595</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>291.0</td>
    </tr>
    <tr>
      <th>C6</th>
      <td>104194.0</td>
      <td>2.804154</td>
      <td>11.183598</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>324.0</td>
    </tr>
    <tr>
      <th>C12</th>
      <td>104194.0</td>
      <td>0.120333</td>
      <td>0.343714</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>D2</th>
      <td>104194.0</td>
      <td>119.018312</td>
      <td>121.706645</td>
      <td>0.0</td>
      <td>58.0</td>
      <td>97.0</td>
      <td>97.0</td>
      <td>638.0</td>
    </tr>
    <tr>
      <th>D3</th>
      <td>104194.0</td>
      <td>20.269181</td>
      <td>55.295476</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>661.0</td>
    </tr>
    <tr>
      <th>D4</th>
      <td>104194.0</td>
      <td>123.171123</td>
      <td>182.208799</td>
      <td>-122.0</td>
      <td>0.0</td>
      <td>16.0</td>
      <td>200.0</td>
      <td>675.0</td>
    </tr>
    <tr>
      <th>D5</th>
      <td>104194.0</td>
      <td>32.580158</td>
      <td>80.391769</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>10.0</td>
      <td>12.0</td>
      <td>671.0</td>
    </tr>
    <tr>
      <th>D10</th>
      <td>104194.0</td>
      <td>109.971025</td>
      <td>174.000499</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>156.0</td>
      <td>672.0</td>
    </tr>
    <tr>
      <th>D11</th>
      <td>104194.0</td>
      <td>112.177237</td>
      <td>167.487081</td>
      <td>-53.0</td>
      <td>0.0</td>
      <td>11.0</td>
      <td>183.0</td>
      <td>664.0</td>
    </tr>
    <tr>
      <th>D15</th>
      <td>104194.0</td>
      <td>146.615055</td>
      <td>194.261467</td>
      <td>-53.0</td>
      <td>0.0</td>
      <td>38.0</td>
      <td>268.0</td>
      <td>671.0</td>
    </tr>
    <tr>
      <th>ProductCD_W</th>
      <td>104194.0</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>card6_credit</th>
      <td>104194.0</td>
      <td>0.166747</td>
      <td>0.372751</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>card6_debit</th>
      <td>104194.0</td>
      <td>0.833234</td>
      <td>0.372768</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>card6_debit or credit</th>
      <td>104194.0</td>
      <td>0.000019</td>
      <td>0.004381</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>M1_F</th>
      <td>104194.0</td>
      <td>0.000019</td>
      <td>0.004381</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>M1_T</th>
      <td>104194.0</td>
      <td>0.999981</td>
      <td>0.004381</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>isFraud: Aproximadamente el 3.12% de las transacciones son fraudulentas.</p></li>
<li><p>card6_debit: Aproximadamente el 83.32% de las tarjetas son de débito.</p></li>
<li><p>card6_debit or credit y M1_T: Ambas columnas tienen valores cercanos a 1 para la mayoría de las entradas, esto sugiere que puede haber poca variación en estos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">annotate_counts</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()),</span> 
                    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> 
                    <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_f</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span> <span class="s2">&quot;isFraud&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fraude&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cantidad&quot;</span><span class="p">)</span>
<span class="n">annotate_counts</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c643fc61a85689e723c28874ee9f972a225fa224c32982ec0fa69f8b390ca1f8.png" src="_images/c643fc61a85689e723c28874ee9f972a225fa224c32982ec0fa69f8b390ca1f8.png" />
</div>
</div>
<p>Se observa que hay un alto desbalance en las clases, esto puede corregirse con tecnicas como Smote.</p>
</section>
<section id="histograma-de-variables-numericas">
<h3>Histograma de variables numericas<a class="headerlink" href="#histograma-de-variables-numericas" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">df_f</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e42e7dd997bfeb18b3443983b38f941b9ee917f875233a8644af5d313852c6a8.png" src="_images/e42e7dd997bfeb18b3443983b38f941b9ee917f875233a8644af5d313852c6a8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_f</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;fraude.csv&quot;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_cols</span> <span class="o">=</span> <span class="n">df_f</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;isFraud&quot;</span><span class="p">,</span> <span class="s2">&quot;M1_F&quot;</span><span class="p">,</span> <span class="s2">&quot;card6_debit or credit&quot;</span><span class="p">,</span> <span class="s2">&quot;C6&quot;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">num_cols</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>  
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">idx</span><span class="o">%</span><span class="k">2</span>]  
        <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df_f</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Boxplot de </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ef2516c73785b298d121cc50b0f971eb1b2351d846064a6553f6377832794ef4.png" src="_images/ef2516c73785b298d121cc50b0f971eb1b2351d846064a6553f6377832794ef4.png" />
</div>
</div>
<p>Se observa que:</p>
<ul class="simple">
<li><p>La mayoria de datos se encuentra en la columna de fraude como se habia mencionado anteriormente</p></li>
<li><p>La mayoria de pagos fueron realizados con tarjeta de debito.</p></li>
<li><p>La tarjeta C6 fue utilizada un gran numero de veces, se evidencian un numero significativos de valores atipicos para esta variable.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_columns_vs_fraud</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;isFraud&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.3</span><span class="p">},</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">},</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Relationship between </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> and isFraud&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">columns_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C6&#39;</span><span class="p">,</span> <span class="s1">&#39;D11&#39;</span><span class="p">,</span> <span class="s1">&#39;ProductCD_W&#39;</span><span class="p">,</span> <span class="s1">&#39;M1_T&#39;</span><span class="p">]</span>
<span class="n">plot_columns_vs_fraud</span><span class="p">(</span><span class="n">df_f</span><span class="p">,</span> <span class="n">columns_to_plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/af21634068979023dabcd31053c4198347bb1722dac23c9ff69b54be037aa879.png" src="_images/af21634068979023dabcd31053c4198347bb1722dac23c9ff69b54be037aa879.png" />
</div>
</div>
<p>Se observa que mayor direcciones asociadas a una tarjeta de credito no influencia en la posibilidad de que sea fraude la transaccion, además se ve una que el hecho de que coincidan o no los nombres en la tarjeta no dictamina si sera fraude una transaccion.</p>
</section>
</section>
<section id="ejercicio-5-modelo-de-clasificacion">
<h2>Ejercicio 5. Modelo de clasificación<a class="headerlink" href="#ejercicio-5-modelo-de-clasificacion" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span><span class="p">,</span> <span class="n">BernoulliNB</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
<span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">ConfusionMatrixDisplay</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">resample</span>
</pre></div>
</div>
</div>
</div>
<p>Los datos de fraude presentan imbalance severo por lo que se utilizara la tecnica de Smote, la cual creara datos sinteticos y balanceara las caracteristicas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df_f</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;isFraud&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_f</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smote</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X_sampled</span><span class="p">,</span> <span class="n">y_sampled</span> <span class="o">=</span> <span class="n">smote</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Por el largo tiempo de computacion se reducira el tamaño del dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_sampled</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(151366, 20)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.08</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_sampled</span><span class="p">))</span> 
<span class="n">X_sampled</span><span class="p">,</span> <span class="n">y_sampled</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">X_sampled</span><span class="p">,</span> <span class="n">y_sampled</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_sampled</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_sampled</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(12109, 20)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">custom_plot_confusion_matrix</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Confusion matrix&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized confusion matrix&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Confusion matrix, without normalization&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">tick_marks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">tick_marks</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">tick_marks</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>

    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;.2f&#39;</span> <span class="k">if</span> <span class="n">normalize</span> <span class="k">else</span> <span class="s1">&#39;d&#39;</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fmt</span><span class="p">),</span>
                 <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thresh</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True label&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Knn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">KNeighborsClassifier</span><span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;kneighborsclassifier__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]}),</span>
    <span class="s2">&quot;Naive Bayes&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">GaussianNB</span><span class="p">(),</span> <span class="p">{}),</span>
    <span class="s2">&quot;XGBoost&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;xgbclassifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span> <span class="s1">&#39;xgbclassifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}),</span>
    <span class="s2">&quot;SVc&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;svc__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;svc__gamma&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;svc__kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;rbf&quot;</span><span class="p">]}),</span>
    <span class="s2">&quot;MLP&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">MLPClassifier</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">5000</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;mlpclassifier__hidden_layer_sizes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;mlpclassifier__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>
<span class="p">}</span>

<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span><span class="s2">&quot;Precision&quot;</span><span class="p">,</span> <span class="s2">&quot;Recall&quot;</span><span class="p">,</span> <span class="s2">&quot;f1-score&quot;</span><span class="p">,</span> <span class="s2">&quot;AUC&quot;</span><span class="p">,</span> <span class="s2">&quot;Test set score&quot;</span><span class="p">])</span>

<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entrenando modelo: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>
    
    <span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_sampled</span><span class="p">,</span> <span class="n">y_sampled</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">y_prob</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    
    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ROC curve (area = </span><span class="si">{</span><span class="n">auc</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ROC Curve para </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">custom_plot_confusion_matrix</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Confusion Matrix for </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s2">&quot;Precision&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
        <span class="s2">&quot;Recall&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
        <span class="s2">&quot;f1-score&quot;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
        <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="n">auc</span><span class="p">,</span>
        <span class="s2">&quot;Test set score&quot;</span><span class="p">:</span> <span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">results_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">result</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entrenando modelo: Knn
</pre></div>
</div>
<img alt="_images/c5c3007698226e2d9de9c039cdf2eb9aef399080da4320421f3ccf5f271d7d31.png" src="_images/c5c3007698226e2d9de9c039cdf2eb9aef399080da4320421f3ccf5f271d7d31.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion matrix, without normalization
</pre></div>
</div>
<img alt="_images/660911979eb51eeddf6b75fbd337b9917b9e2e0115197b562e6be873b796d9bf.png" src="_images/660911979eb51eeddf6b75fbd337b9917b9e2e0115197b562e6be873b796d9bf.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entrenando modelo: Naive Bayes
</pre></div>
</div>
<img alt="_images/922c0a28903a8829bd10b91320d7d32ec866f17c09a65f472527bfd28963a59c.png" src="_images/922c0a28903a8829bd10b91320d7d32ec866f17c09a65f472527bfd28963a59c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion matrix, without normalization
</pre></div>
</div>
<img alt="_images/747b0db9e04e35daf12832e67bba3a6c25b7ebb07059fc222c9e86e5bfcfff24.png" src="_images/747b0db9e04e35daf12832e67bba3a6c25b7ebb07059fc222c9e86e5bfcfff24.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entrenando modelo: XGBoost
</pre></div>
</div>
<img alt="_images/5b34dd83bb99204ee3ea3ad60e43435357e6258c7803bde8a2724c70bcb1374f.png" src="_images/5b34dd83bb99204ee3ea3ad60e43435357e6258c7803bde8a2724c70bcb1374f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion matrix, without normalization
</pre></div>
</div>
<img alt="_images/717aa203e83286718cd22fc87f92d15a27a7bfe69323b41964a12d4435439562.png" src="_images/717aa203e83286718cd22fc87f92d15a27a7bfe69323b41964a12d4435439562.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entrenando modelo: SVc
</pre></div>
</div>
<img alt="_images/f9ec934cb9d4a610fef42ce331a586c4ebe49b4ea1f3bbcbfc2c342eef257afb.png" src="_images/f9ec934cb9d4a610fef42ce331a586c4ebe49b4ea1f3bbcbfc2c342eef257afb.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion matrix, without normalization
</pre></div>
</div>
<img alt="_images/c91497e56888248e649fd1cd933caa01e5155d04c02753e5144292a9b593ab2b.png" src="_images/c91497e56888248e649fd1cd933caa01e5155d04c02753e5144292a9b593ab2b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entrenando modelo: MLP
</pre></div>
</div>
<img alt="_images/8dae49ebad0195825fee9535c47a992e05f14fe5d4ce927bac7019aa4154bb03.png" src="_images/8dae49ebad0195825fee9535c47a992e05f14fe5d4ce927bac7019aa4154bb03.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion matrix, without normalization
</pre></div>
</div>
<img alt="_images/af068e07bfb973a3d28f5a0c50bb0c8f17ab4aa96d0015290ac745bff57348f1.png" src="_images/af068e07bfb973a3d28f5a0c50bb0c8f17ab4aa96d0015290ac745bff57348f1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         Model  Precision    Recall  f1-score       AUC  Test set score
0          Knn   0.098969  0.641058  0.171467  0.728785        0.769207
1  Naive Bayes   0.035473  0.877834  0.068190  0.563704        0.664352
2      XGBoost   0.264183  0.392947  0.315949  0.679269        0.789138
3          SVc   0.141038  0.557935  0.225159  0.725552        0.768335
4          MLP   0.105774  0.576826  0.178767  0.711755        0.780326
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Knn (K-Nearest Neighbors)</p></li>
</ul>
<p>Precisión: 9.9%: De todas las predicciones positivas realizadas, alrededor del 10% fueron correctas.
Recall: el modelo identificó correctamente el 64.1%.
AUC: 72.9%: es un valor aceptable, indica que el modelo tiene una capacidad razonable para distinguir entre las clases.
Conclusión: Knn tiene una buena sensibilidad pero una baja precisión, lo que significa que detecta bien el fraude.</p>
<ul class="simple">
<li><p>Naive Bayes</p></li>
</ul>
<p>Precisión: 3.5%: es un valor significamente bajo, esto significa que hay muchos falsos positivos.
Recall: 87.8%: significativamente alta sensibilidad, esto indica que el modelo es capaz de detectar muy bien los FP.
AUC: 56.4%: Justo por encima de un clasificador aleatorio.
Conclusión: A pesar de su alta sensibilidad, la precisión extremadamente baja de Naive Bayes sugiere que produce muchos falsos positivos.</p>
<ul class="simple">
<li><p>XGBoost</p></li>
</ul>
<p>Precisión: alrededor del 26.4% fueron correctas.
Recall: 39.3% el modelo tiene una sensibilidad moderada.
AUC: 67.9%: al igual que Naive Bayes esta levemente por encima de un cualquier clasificador.
Conclusión: XGBoost tiene un equilibrio entre precisión y sensibilidad.</p>
<ul class="simple">
<li><p>Support Vector Machine</p></li>
</ul>
<p>Precisión: 14.1%, indica  lo que indica falsos positivos.
Recall: 55.8%: Sensibilidad moderada-alta.
AUC: 72.6%: Un valor aceptable.
Conclusión: SVc tiene una sensibilidad decente y una AUC aceptable, pero el  modelo presenta una precision baja.</p>
<ul class="simple">
<li><p>MLP (Multi-Layer Perceptron)</p></li>
</ul>
<p>Precisión: 10.9% que indica muchos falsos positivos.
Recall: 57.4%: Sensibilidad moderada-alta.
AUC: 71.3%: Un valor aceptable.
Conclusión: MLP, al igual que SVc, muestra una sensibilidad decente y una AUC aceptable, pero su precisión es baja.</p>
<p>En conclusion los modelos que mejor capacidad de generalizar tienen son XGBoost y MLP, seguidos de KNN y SVM.</p>
<section id="ejercicio-5-modelos-de-regresion">
<h3>Ejercicio 5. Modelos de regresion<a class="headerlink" href="#ejercicio-5-modelos-de-regresion" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_wind</span> <span class="o">=</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_wind</span><span class="p">)</span>

<span class="n">midpoint</span> <span class="o">=</span> <span class="n">total_rows</span> <span class="o">//</span> <span class="mi">14</span>

<span class="n">df_mitad</span> <span class="o">=</span> <span class="n">df_wind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">midpoint</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_mitad</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6263, 9)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">=</span> <span class="n">df_mitad</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;velocidad horaria viento&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_mitad</span><span class="p">[</span><span class="s1">&#39;velocidad horaria viento&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6263, 8)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_test</span> <span class="o">=</span> <span class="n">df_mitad</span><span class="p">[</span><span class="o">-</span><span class="mi">24</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span> 
    <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
    <span class="c1"># Evitar divisiones por cero</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_true</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">/</span> <span class="n">y_true</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">window_size</span> <span class="o">=</span><span class="mi">24</span> 
<span class="n">total_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_mitad</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
<span class="n">max_rows_divisible_by_24</span><span class="o">=</span> <span class="p">(</span><span class="n">total_rows</span><span class="o">//</span><span class="n">window_size</span><span class="p">)</span><span class="o">*</span><span class="n">window_size</span>
<span class="n">iterations</span> <span class="o">=</span><span class="p">(</span><span class="n">max_rows_divisible_by_24</span> <span class="o">//</span> <span class="n">window_size</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="kneighborsregressor">
<h3>KNeighborsRegressor<a class="headerlink" href="#kneighborsregressor" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>

<span class="n">n_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>

<span class="n">best_rmse_overall</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">best_n</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_mape_overall</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_r2_overall</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_values</span><span class="p">:</span>
    
    <span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">mape_values_total</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rmse_values_total</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">r2_values_total</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
        <span class="n">train_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">train_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">val_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span>
        <span class="n">val_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_start</span><span class="p">:</span><span class="n">train_end</span><span class="p">]</span>
        <span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_start</span><span class="p">:</span><span class="n">train_end</span><span class="p">]</span>
        <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_start</span><span class="p">:</span><span class="n">val_end</span><span class="p">]</span>
        <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_start</span><span class="p">:</span><span class="n">val_end</span><span class="p">]</span>

        <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

        <span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_val</span><span class="p">))</span>
        
        <span class="n">mape_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
        <span class="n">mape_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mape_values</span><span class="p">)</span>
        <span class="n">rmse_values</span><span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>
        <span class="n">rmse_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse_values</span><span class="p">)</span>
        <span class="n">r2_values</span><span class="o">=</span> <span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
        <span class="n">r2_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2_values</span><span class="p">)</span>

    <span class="n">mean_mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mape_values_total</span><span class="p">)</span>
    <span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_values_total</span><span class="p">)</span>
    <span class="n">mean_r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r2_values_total</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mean_rmse</span> <span class="o">&lt;</span> <span class="n">best_rmse_overall</span><span class="p">:</span>
        <span class="n">best_rmse_overall</span> <span class="o">=</span> <span class="n">mean_rmse</span>
        <span class="n">best_mape_overall</span> <span class="o">=</span> <span class="n">mean_mape</span>
        <span class="n">best_r2_overall</span> <span class="o">=</span> <span class="n">mean_r2</span>
        <span class="n">best_paramter_knn</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n</span><span class="p">}</span>
        
<span class="nb">print</span><span class="p">(</span><span class="n">best_paramter_knn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;n&#39;: 7}
</pre></div>
</div>
</div>
</div>
</section>
<section id="lasso">
<h3>Lasso<a class="headerlink" href="#lasso" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>

<span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">best_rmse_overall</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">best_n</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_mape_overall</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_r2_overall</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
    
    <span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    
    <span class="n">mape_values_total</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rmse_values_total</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">r2_values_total</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
        <span class="n">train_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">train_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">val_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span>
        <span class="n">val_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_start</span><span class="p">:</span><span class="n">train_end</span><span class="p">]</span>
        <span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_start</span><span class="p">:</span><span class="n">train_end</span><span class="p">]</span>
        <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_start</span><span class="p">:</span><span class="n">val_end</span><span class="p">]</span>
        <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_start</span><span class="p">:</span><span class="n">val_end</span><span class="p">]</span>

        <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

        <span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_val</span><span class="p">))</span>
        
        <span class="n">mape_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
        <span class="n">mape_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mape_values</span><span class="p">)</span>
        <span class="n">rmse_values</span><span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>
        <span class="n">rmse_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse_values</span><span class="p">)</span>
        <span class="n">r2_values</span><span class="o">=</span> <span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
        <span class="n">r2_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2_values</span><span class="p">)</span>

    <span class="n">mean_mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mape_values_total</span><span class="p">)</span>
    <span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_values_total</span><span class="p">)</span>
    <span class="n">mean_r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r2_values_total</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mean_rmse</span> <span class="o">&lt;</span> <span class="n">best_rmse_overall</span><span class="p">:</span>
        <span class="n">best_rmse_overall</span> <span class="o">=</span> <span class="n">mean_rmse</span>
        <span class="n">best_mape_overall</span> <span class="o">=</span> <span class="n">mean_mape</span>
        <span class="n">best_r2_overall</span> <span class="o">=</span> <span class="n">mean_r2</span>
        <span class="n">best_paramter_lasso</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">}</span>
        
<span class="nb">print</span><span class="p">(</span><span class="n">best_paramter_lasso</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;alpha&#39;: 0.001}
</pre></div>
</div>
</div>
</div>
</section>
<section id="ridge">
<h3>Ridge<a class="headerlink" href="#ridge" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>

<span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">best_rmse_overall</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">best_n</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_mape_overall</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_r2_overall</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
    
    <span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    
    <span class="n">mape_values_total</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rmse_values_total</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">r2_values_total</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
        <span class="n">train_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">train_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">val_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span>
        <span class="n">val_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_start</span><span class="p">:</span><span class="n">train_end</span><span class="p">]</span>
        <span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_start</span><span class="p">:</span><span class="n">train_end</span><span class="p">]</span>
        <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_start</span><span class="p">:</span><span class="n">val_end</span><span class="p">]</span>
        <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_start</span><span class="p">:</span><span class="n">val_end</span><span class="p">]</span>

        <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

        <span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_val</span><span class="p">))</span>
        
        <span class="n">mape_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
        <span class="n">mape_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mape_values</span><span class="p">)</span>
        <span class="n">rmse_values</span><span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>
        <span class="n">rmse_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse_values</span><span class="p">)</span>
        <span class="n">r2_values</span><span class="o">=</span> <span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
        <span class="n">r2_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2_values</span><span class="p">)</span>

    <span class="n">mean_mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mape_values_total</span><span class="p">)</span>
    <span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_values_total</span><span class="p">)</span>
    <span class="n">mean_r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r2_values_total</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mean_rmse</span> <span class="o">&lt;</span> <span class="n">best_rmse_overall</span><span class="p">:</span>
        <span class="n">best_rmse_overall</span> <span class="o">=</span> <span class="n">mean_rmse</span>
        <span class="n">best_mape_overall</span> <span class="o">=</span> <span class="n">mean_mape</span>
        <span class="n">best_r2_overall</span> <span class="o">=</span> <span class="n">mean_r2</span>
        <span class="n">best_parameter_ridge</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">}</span>
        
<span class="nb">print</span><span class="p">(</span><span class="n">best_parameter_ridge</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;alpha&#39;: 1}
</pre></div>
</div>
</div>
</div>
</section>
<section id="xgboost">
<h3>XGboost<a class="headerlink" href="#xgboost" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>

<span class="n">n_estimators_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
<span class="n">max_depth_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">best_rmse_overall</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">best_n</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_mape_overall</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_r2_overall</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">for</span> <span class="n">n_estimators</span> <span class="ow">in</span> <span class="n">n_estimators_values</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">max_depth</span> <span class="ow">in</span> <span class="n">max_depth_values</span><span class="p">:</span>
        
        <span class="n">xgb_regressor</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">)</span>
        <span class="n">mape_values_total</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rmse_values_total</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">r2_values_total</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
            <span class="n">train_start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">train_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">val_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span>
            <span class="n">val_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_start</span><span class="p">:</span><span class="n">train_end</span><span class="p">]</span>
            <span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_start</span><span class="p">:</span><span class="n">train_end</span><span class="p">]</span>
            <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_start</span><span class="p">:</span><span class="n">val_end</span><span class="p">]</span>
            <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_start</span><span class="p">:</span><span class="n">val_end</span><span class="p">]</span>

            <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
            <span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

            <span class="n">xgb_regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">xgb_regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_val</span><span class="p">))</span>
            
            <span class="n">mape_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
            <span class="n">mape_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mape_values</span><span class="p">)</span>
            <span class="n">rmse_values</span><span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>
            <span class="n">rmse_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse_values</span><span class="p">)</span>
            <span class="n">r2_values</span><span class="o">=</span> <span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
            <span class="n">r2_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2_values</span><span class="p">)</span>

        <span class="n">mean_mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mape_values_total</span><span class="p">)</span>
        <span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_values_total</span><span class="p">)</span>
        <span class="n">mean_r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r2_values_total</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mean_rmse</span> <span class="o">&lt;</span> <span class="n">best_rmse_overall</span><span class="p">:</span>
            <span class="n">best_rmse_overall</span> <span class="o">=</span> <span class="n">mean_rmse</span>
            <span class="n">best_mape_overall</span> <span class="o">=</span> <span class="n">mean_mape</span>
            <span class="n">best_r2_overall</span> <span class="o">=</span> <span class="n">mean_r2</span>
            <span class="n">best_parameter_xgboost</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;n_estimators&quot;</span><span class="p">:</span> <span class="n">n_estimators</span><span class="p">,</span><span class="s2">&quot;max_depth_values&quot;</span><span class="p">:</span><span class="n">max_depth_values</span><span class="p">}</span>
        
<span class="nb">print</span><span class="p">(</span><span class="n">best_parameter_xgboost</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;n_estimators&#39;: 100, &#39;max_depth_values&#39;: [3, 4, 5]}
</pre></div>
</div>
</div>
</div>
</section>
<section id="svr">
<h3>SVR<a class="headerlink" href="#svr" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>

<span class="n">C_values</span><span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">gamma_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">kernel_values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rbf&quot;</span><span class="p">,</span> <span class="s2">&quot;linear&quot;</span><span class="p">]</span>

<span class="n">best_rmse_overall</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">best_n</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_mape_overall</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_r2_overall</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">for</span> <span class="n">C_value</span> <span class="ow">in</span> <span class="n">C_values</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">gamma_value</span> <span class="ow">in</span> <span class="n">gamma_values</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">kernel_value</span> <span class="ow">in</span> <span class="n">kernel_values</span><span class="p">:</span>
    
            <span class="n">svr_regression</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">C_value</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma_value</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="n">kernel_value</span><span class="p">)</span> 
            <span class="n">mape_values_total</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">rmse_values_total</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">r2_values_total</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
                <span class="n">train_start</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">train_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">val_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span>
                <span class="n">val_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_start</span><span class="p">:</span><span class="n">train_end</span><span class="p">]</span>
                <span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_start</span><span class="p">:</span><span class="n">train_end</span><span class="p">]</span>
                <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_start</span><span class="p">:</span><span class="n">val_end</span><span class="p">]</span>
                <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_start</span><span class="p">:</span><span class="n">val_end</span><span class="p">]</span>

                <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
                <span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

                <span class="n">svr_regression</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">svr_regression</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_val</span><span class="p">))</span>
                
                <span class="n">mape_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
                <span class="n">mape_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mape_values</span><span class="p">)</span>
                <span class="n">rmse_values</span><span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>
                <span class="n">rmse_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse_values</span><span class="p">)</span>
                <span class="n">r2_values</span><span class="o">=</span> <span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
                <span class="n">r2_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2_values</span><span class="p">)</span>

            <span class="n">mean_mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mape_values_total</span><span class="p">)</span>
            <span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_values_total</span><span class="p">)</span>
            <span class="n">mean_r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r2_values_total</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mean_rmse</span> <span class="o">&lt;</span> <span class="n">best_rmse_overall</span><span class="p">:</span>
                <span class="n">best_rmse_overall</span> <span class="o">=</span> <span class="n">mean_rmse</span>
                <span class="n">best_mape_overall</span> <span class="o">=</span> <span class="n">mean_mape</span>
                <span class="n">best_r2_overall</span> <span class="o">=</span> <span class="n">mean_r2</span>
                <span class="n">best_parameter_svr</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="n">C_value</span><span class="p">,</span><span class="s2">&quot;gamma&quot;</span><span class="p">:</span><span class="n">gamma_value</span><span class="p">,</span><span class="s2">&quot;kernel&quot;</span><span class="p">:</span><span class="n">kernel_value</span><span class="p">}</span>
        
<span class="nb">print</span><span class="p">(</span><span class="n">best_parameter_svr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;C&#39;: 1, &#39;gamma&#39;: 1, &#39;kernel&#39;: &#39;rbf&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="mlp-regressor">
<h3>MLP Regressor<a class="headerlink" href="#mlp-regressor" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPRegressor</span>

<span class="n">hidden_layer_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">activation</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu&quot;</span><span class="p">,</span><span class="s2">&quot;identity&quot;</span><span class="p">]</span>

<span class="n">best_rmse_overall</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">best_n</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_mape_overall</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_r2_overall</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">hidden_layer</span> <span class="ow">in</span> <span class="n">hidden_layer_sizes</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">alp</span> <span class="ow">in</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">activation</span><span class="p">:</span> 
            
            <span class="n">mlp_regressor</span> <span class="o">=</span> <span class="n">MLPRegressor</span><span class="p">(</span><span class="n">hidden_layer_sizes</span><span class="o">=</span><span class="n">hidden_layer</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">act</span><span class="p">)</span>
            <span class="n">mape_values_total</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">rmse_values_total</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">r2_values_total</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
                <span class="n">train_start</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">train_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">val_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span>
                <span class="n">val_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">window_size</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_start</span><span class="p">:</span><span class="n">train_end</span><span class="p">]</span>
                <span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_start</span><span class="p">:</span><span class="n">train_end</span><span class="p">]</span>
                <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_start</span><span class="p">:</span><span class="n">val_end</span><span class="p">]</span>
                <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">val_start</span><span class="p">:</span><span class="n">val_end</span><span class="p">]</span>

                <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
                <span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

                <span class="n">mlp_regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">mlp_regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_val</span><span class="p">))</span>
                
                <span class="n">mape_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
                <span class="n">mape_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mape_values</span><span class="p">)</span>
                <span class="n">rmse_values</span><span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>
                <span class="n">rmse_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse_values</span><span class="p">)</span>
                <span class="n">r2_values</span><span class="o">=</span> <span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
                <span class="n">r2_values_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2_values</span><span class="p">)</span>

            <span class="n">mean_mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mape_values_total</span><span class="p">)</span>
            <span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_values_total</span><span class="p">)</span>
            <span class="n">mean_r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r2_values_total</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mean_rmse</span> <span class="o">&lt;</span> <span class="n">best_rmse_overall</span><span class="p">:</span>
                <span class="n">best_rmse_overall</span> <span class="o">=</span> <span class="n">mean_rmse</span>
                <span class="n">best_mape_overall</span> <span class="o">=</span> <span class="n">mean_mape</span>
                <span class="n">best_r2_overall</span> <span class="o">=</span> <span class="n">mean_r2</span>
                <span class="n">best_parameter_mlp</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;hidden_layer&quot;</span><span class="p">:</span> <span class="n">hidden_layer</span><span class="p">,</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span><span class="n">alpha</span><span class="p">,</span><span class="s2">&quot;activation&quot;</span><span class="p">:</span><span class="n">activation</span><span class="p">}</span>
        
<span class="nb">print</span><span class="p">(</span><span class="n">best_parameter_mlp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;hidden_layer&#39;: 100, &#39;alpha&#39;: [0.01, 0.1, 1], &#39;activation&#39;: [&#39;relu&#39;, &#39;identity&#39;]}
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluacion-de-los-modelos-con-los-mejores-parametros">
<h3>Evaluacion de los modelos con los mejores parametros<a class="headerlink" href="#evaluacion-de-los-modelos-con-los-mejores-parametros" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_wind</span> <span class="o">=</span> <span class="n">wind_test</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;velocidad horaria viento&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_wind</span> <span class="o">=</span> <span class="n">wind_test</span><span class="p">[</span><span class="s1">&#39;velocidad horaria viento&#39;</span><span class="p">]</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">df_mitad</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;velocidad horaria viento&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">df_mitad</span><span class="p">[</span><span class="s1">&#39;velocidad horaria viento&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Knn&quot;</span><span class="p">:</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span>
    <span class="s2">&quot;Ridge&quot;</span><span class="p">:</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.001</span><span class="p">),</span>
    <span class="s2">&quot;Lasso&quot;</span><span class="p">:</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;XGBoost&quot;</span><span class="p">:</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="s2">&quot;SVR&quot;</span><span class="p">:</span> <span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">),</span>
    <span class="s2">&quot;MLP&quot;</span><span class="p">:</span> <span class="n">MLPRegressor</span><span class="p">(</span><span class="n">hidden_layer_sizes</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">activation</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span> <span class="s2">&quot;Best RMSE&quot;</span><span class="p">,</span> <span class="s2">&quot;MAPE&quot;</span><span class="p">,</span> <span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="s2">&quot;Test set score&quot;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_instance</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">model_instance</span><span class="p">)</span>
    <span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>  <span class="c1"># change this if you want predictions on a different set</span>
    <span class="n">mape</span> <span class="o">=</span> <span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
        <span class="s2">&quot;Best RMSE&quot;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span>
        <span class="s2">&quot;MAPE&quot;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span>
        <span class="s2">&quot;R2&quot;</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
        <span class="s2">&quot;Test set score&quot;</span><span class="p">:</span> <span class="n">pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_wind</span><span class="p">,</span> <span class="n">y_wind</span><span class="p">)</span>  <span class="c1"># might want to change X_wind and y_wind if it&#39;s not the desired set</span>
    <span class="p">}</span>
    
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">results_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">result</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">results_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model</th>
      <th>Best RMSE</th>
      <th>MAPE</th>
      <th>R2</th>
      <th>Test set score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Knn</td>
      <td>0.568893</td>
      <td>31.383783</td>
      <td>0.819546</td>
      <td>0.788553</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ridge</td>
      <td>0.617563</td>
      <td>31.890031</td>
      <td>0.787349</td>
      <td>0.777957</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lasso</td>
      <td>1.339207</td>
      <td>87.332642</td>
      <td>0.000000</td>
      <td>-0.418807</td>
    </tr>
    <tr>
      <th>3</th>
      <td>XGBoost</td>
      <td>0.493419</td>
      <td>26.385804</td>
      <td>0.864251</td>
      <td>0.824055</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SVR</td>
      <td>0.555373</td>
      <td>29.760821</td>
      <td>0.828022</td>
      <td>0.810566</td>
    </tr>
    <tr>
      <th>5</th>
      <td>MLP</td>
      <td>0.620310</td>
      <td>32.480895</td>
      <td>0.785453</td>
      <td>0.771317</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="conclusion">
<h4>Conclusión<a class="headerlink" href="#conclusion" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Knn: Este modelo tiene un buen desempeño con un RMSE de 0.5689 y r2 de  0.8195, en el conjunto de prueba, tiene un score de 0.7885.</p></li>
<li><p>Ridge: Aunque tiene un RMSE ligeramente más alto que el Knn, sigue siendo competitivo. Su test set score de 0.77 en el conjunto de test indica que tiene buena capacidad para generalizar.</p></li>
<li><p>Lasso: Este modelo no se desempeña bien en estos datos. Su RMSE es considerablemente alto y su R2 es 0, lo que indica que no es capaz de explicar la variabilidad de los datos. Además, su score negativo en el conjunto de test indica que modelo se desempeña pesimamente para generalizar datos que no conoce.</p></li>
<li><p>XGBoost: Este es el modelo que mejor desempeño tiene entre todos. Con el RMSE más bajo de 0.4934 y un de 0.8642. Además, tiene el score más alto en el conjunto de test de 0.8241.</p></li>
<li><p>SVR: El modelo SVR también muestra un buen desempeño con un RMSE de 0.5553 y un R2 de 0.8280, con un rendimiento de 0.81 para test.</p></li>
<li><p>MLP: Aunque este modelo tiene un RMSE y similares al modelo Ridge, su score en el conjunto de prueba es ligeramente menor.</p></li>
</ul>
<p>Basándonos en el RMSE, R2 y el score en el conjunto de test, XGBoost es el modelo que mejor se desempeña en el conjunto de datos de pronostico de velocidad del viento.</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="markdown.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Markdown Files</p>
      </div>
    </a>
    <a class="right-next"
       href="markdown-notebooks.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notebooks with MyST Markdown</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-wind-speed">Datos Wind Speed</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descripcion-del-tipo-de-variables">Descripcion del tipo de variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduccion-de-nombres-extensos-en-columnas">Reducción de nombres extensos en columnas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#numero-de-observaciones-media-desviacion-estandar-minimo-maximo-cuartiles">Número de observaciones, media, desviación estándar, mínimo, máximo, cuartiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conteo-de-datos-faltantes-y-su-porcentaje">Conteo de datos faltantes y su porcentaje</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#histograma-o-diagrama-de-barras-para-la-variables">Histograma o diagrama de barras para la variables</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-fraud-detection">Datos Fraud Detection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Descripcion del tipo de variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calcular-numero-de-observaciones-media-desviacion-estandar-minimo-maximo-cuartiles">Calcular número de observaciones, media, desviación estándar, mínimo, máximo, cuartiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#histograma-de-variables-numericas">Histograma de variables numericas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ejercicio-5-modelo-de-clasificacion">Ejercicio 5. Modelo de clasificación</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ejercicio-5-modelos-de-regresion">Ejercicio 5. Modelos de regresion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kneighborsregressor">KNeighborsRegressor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso">Lasso</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge">Ridge</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost">XGboost</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#svr">SVR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mlp-regressor">MLP Regressor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluacion-de-los-modelos-con-los-mejores-parametros">Evaluacion de los modelos con los mejores parametros</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusión</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>